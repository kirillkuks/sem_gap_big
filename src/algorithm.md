# Intelegent Placer: первая версия алгоритма

Алгоритм состоит из нескольких этапов
* Определение предметов на входном изображении
* Определение параметров многоугольника на входном изображении
* Размещение предметов внутри прямоугольника

## Предобработка
Сначала нужно запомнить множество исходных предметов, для этого:
* Для всех изображений предметов:
  * С помощью тресхолда Оцу находим область фото, на которой изображен предмет (на белом листе он отчётливо выделяется)
  * Применяем морфологическое закрытие, чтобы маска была более гладкой, затем морфологическое раскрытие, чтобы избавиться от мелких шумов
  * Накладываем полученную маску на изображение предмета, чтобы избавиться от области вокруг листа бумаги
  * Находим особые точки и сохраняем их
  
## Определение предметов на входном изображении и многоугольника
* Считаем разницу между входным изображением и изображением фона
* У полученной разности находим с помощью детектора Кэнни границы предметов, заполняем области внутри контуров, удаляем мелкие шумы с помощью морфологического раскрытия
* Находим все области связности на полученному изображении и для каждой области связности, кроме области, которая имеет наименьшую координату по y центра масс:
  * Накладываем на входное изображение маску, соответствующую текущей области связности, чтобы получить только один предмет на белом фоне
  * Находим на новом изображении особые точки и сопоставляем с особыми точками изображений, найденных на этапе предобработки
  * Пара наборов особых точек (известная и найденная), которая имеет наибольшую долю совпавших точек, определяет предмет
* В качестве области соответствующей многоугольнику выбираем область, которая имеет наименьшую координату по y центра масс

## Размещение предметов внутри прямоугольника
* Посчитать сумму площадей найденных предметов
* Сравнить с площадью многоугольника

# Примечание
* Для простоты тестирования код не ещё не выносился в библиотеку и содержит много кода для отладки
* На данном этапе используется наивный и неправильный алгоритм проверки того, поместятся ли предметы в многоугольник. Улучшенная версия этого алгоритма переноситься на следующую итерацию
* Тесты показали, что предложенный алгоритм имеет около половины неверно определённых предметов по критерию доли совпавших особых точек
